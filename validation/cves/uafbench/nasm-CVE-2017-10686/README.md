# CVE2017-10686

[related Document](https://bugzilla.nasm.us/show_bug.cgi?id=3392414)

## Use After Free (UAF)
UAF occurs at `asm/preproc.c:1289`

```c
static char *detoken(Token * tlist, bool expand_locals)
{
    // ...
 if (expand_locals &&
            t->type == TOK_PREPROC_ID && t->text && // This Point!
            t->text[0] == '%' && t->text[1] == '$') {
            const char *q;
            char *p;
            Context *ctx = get_ctx(t->text, &q);
            if (ctx) {
                char buffer[40];
                snprintf(buffer, sizeof(buffer), "..@%"PRIu32".", ctx->number);
                p = nasm_strcat(buffer, q);
                nasm_free(t->text);
                t->text = p;
            }
        }
    // ...

}
```