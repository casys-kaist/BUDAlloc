RED="\e[31m"
GREEN="\e[32m"
PURPLE="\e[35m"
ENDCOLOR="\e[0m"

BENCH_TARGET=$1
COMM=""
UAF_POINT="bzip2recover.c:182"

case $BENCH_TARGET in
  "BUDAlloc")
        COMM="LD_PRELOAD=libkernel.so ./bzip2/bzip2recover ./poc"
    ;;
  "ffmalloc")
        COMM="LD_PRELOAD=/home/babamba/ffmalloc/libffmallocnpmt.so ./bzip2/bzip2recover ./poc"
    ;;
  "dangzero")
        COMM="LD_PRELOAD=/trusted/wrap.so ./bzip2/bzip2recover ./poc"
    ;;
  * )
        COMM="./bzip2/bzip2recover ./poc"
    ;;
esac


# If output file exits, then PREVENT
# If not, it is detect
sudo gdb -batch -ex r -ex bt --args env ${COMM} > test_output.txt 2>&1

if [ -f "rec00001poc.bz2" ]; then 
  sudo rm -f rec00001poc.bz2
  echo "PREVENT"
  else 
  echo "DETECT"
fi