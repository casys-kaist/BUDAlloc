RED="\e[31m"
GREEN="\e[32m"
PURPLE="\e[35m"
ENDCOLOR="\e[0m"

BENCH_TARGET=$1
COMM=""
UAF_POINT="stream.c:564"


case $BENCH_TARGET in
  "BUDAlloc")
        COMM="LD_PRELOAD=libkernel.so ./lrzip/lrzip -t ./poc.lrz"
    ;;
  "ffmalloc")
        COMM="LD_PRELOAD=/home/babamba/ffmalloc/libffmallocnpmt.so ./lrzip/lrzip -t ./poc.lrz"
    ;;
  "dangzero")
        COMM="LD_PRELOAD=/trusted/wrap.so ./lrzip/lrzip -t ./poc.lrz"
    ;;
  * )
        COMM="./lrzip/lrzip -t ./poc.lrz"
    ;;
esac

# We just check if segfault occurs because GDB couldnt catch SEGFAULT.
sudo sh -c "${COMM}" > test_output.txt 2>&1
# sudo gdb -batch -ex r -ex bt --args env ${COMM} > test_output.txt 2>&1
if grep "Segmentation fault" ./test_output.txt >/dev/null;  then 
    echo "DETECT"
else 
    echo "CANNOT_DETERMINE"
fi